<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Valentine's Day</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="stylesheet" href="/src/style.css">
    <link rel="preload" href="/images/kilig.mp3" as="audio">
    <style>
        body {
            background-color: #4c0519;
        }

        .heart-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .heart {
            position: absolute;
            bottom: -50px;
            opacity: 0.5;
            color: #ff4d6d;
            animation: floatHeart 6s linear infinite;
            font-size: 2rem;
        }

        @keyframes floatHeart {
            0% {
                transform: translateY(0) scale(1) rotate(0);
                opacity: 0;
            }

            50% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(-120vh) scale(1.5) rotate(45deg);
                opacity: 0;
            }
        }

        .quote-box {
            transition: opacity 1s ease-in-out;
        }
    </style>
</head>

<body
    class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-500 overflow-x-hidden min-h-screen flex flex-col">

    <nav class="fixed top-0 w-full z-50 p-4 flex justify-between items-center mix-blend-difference text-white">
        <a href="/" class="text-2xl font-bold tracking-wider hover:scale-105 transition-transform">
            HappyDay
        </a>
        <div class="flex gap-4">
            <div class="relative flex items-center justify-center group">
                <div id="audio-pulse"
                    class="absolute inset-0 rounded-full bg-pink-500/30 animate-ping scale-75 pointer-events-none">
                </div>
                <button id="bgm-toggle"
                    class="p-1.5 rounded-full glass hover:bg-white/20 transition cursor-pointer relative z-10 text-sm"
                    title="Enable Sound">ğŸ”‡</button>
                <div id="audio-hint"
                    class="absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-pink-600/90 backdrop-blur-sm text-white text-[9px] font-bold px-2 py-1 rounded-full whitespace-nowrap animate-bounce shadow-lg z-20 flex items-center gap-1 border border-white/20">
                    <span class="text-[10px] inline-block -mt-[1px]">ğŸµ</span> ON
                </div>
            </div>
            <button id="theme-toggle"
                class="p-2 rounded-full glass hover:bg-white/20 transition cursor-pointer">ğŸŒ“</button>
        </div>
    </nav>
    <audio id="bgm-audio" loop autoplay muted src="/images/valentines.mp3"></audio>

    <main class="flex-grow flex relative w-full h-full">
        <div class="absolute inset-0 bg-gradient-to-br from-rose-900 via-pink-900 to-black z-0"></div>
        <div class="heart-bg z-0" id="heart-container"></div>
        <div
            class="relative z-10 flex flex-col items-center justify-start min-h-screen text-center p-4 pt-24 w-full max-w-4xl mx-auto">
            <div class="valentine-items animate-bounce mb-2">
                <span class="text-6xl drop-shadow-[0_0_20px_rgba(255,20,147,0.8)]">ğŸ’–</span>
            </div>
            <h1
                class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-pink-300 mb-8 filter drop-shadow-md">
                Happy Valentine's Day
            </h1>
            <div class="glass p-8 rounded-3xl w-full max-w-lg mb-8 relative flex flex-col items-center justify-center border border-pink-500/30 transition-all duration-500"
                id="valentine-question-card">
                <h2 class="text-3xl font-bold text-pink-200 mb-4 drop-shadow-md text-center">Will you be my Valentine?
                </h2>
                <img id="valentine-img" src="/images/1.jpg"
                    class="w-40 h-auto rounded-xl mb-6 shadow-[0_0_15px_rgba(236,72,153,0.8)] filter drop-shadow-xl object-contain bg-white"
                    alt="Cute pleading face" />
                <div class="flex items-center justify-center gap-6 w-full h-[50px]" id="valentine-btn-container">
                    <button id="btn-yes"
                        class="px-8 py-3 bg-gradient-to-r from-green-400 to-emerald-500 rounded-full text-white font-bold text-xl hover:scale-110 shadow-[0_0_20px_rgba(16,185,129,0.5)] transition-transform z-10 relative">
                        Yes! ğŸ¥°
                    </button>
                    <button id="btn-no"
                        class="px-8 py-3 bg-gradient-to-r from-red-400 to-rose-500 rounded-full text-white font-bold text-xl shadow-[0_0_20px_rgba(244,63,94,0.5)] relative z-50 transition-all duration-200 cursor-pointer">
                        No ğŸ˜¢
                    </button>
                </div>
            </div>
            <div class="fixed bottom-6 left-6 flex flex-col gap-4 z-40">
                <button id="send-heart"
                    class="px-6 py-3 bg-gradient-to-r from-pink-500 to-rose-600 rounded-full text-white font-bold text-lg hover:scale-105 shadow-[0_0_20px_rgba(236,72,153,0.5)] transition-all flex items-center gap-2">
                    <span>Send Heart</span> ğŸ’˜
                </button>
                <button onclick="document.getElementById('msg-modal').classList.remove('hidden')"
                    class="px-6 py-3 bg-transparent border border-pink-400 bg-pink-950/40 backdrop-blur-md rounded-full text-pink-300 font-bold text-lg hover:bg-pink-900/80 hover:scale-105 transition-all flex items-center gap-2">
                    <span>Write Note</span> âœï¸
                </button>
            </div>
        </div>
    </main>

    <div id="msg-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden">
        <div class="glass p-8 rounded-3xl w-full max-w-md flex flex-col items-center">
            <h3 class="text-2xl text-pink-300 mb-4 font-bold">Write a Love Note</h3>
            <textarea id="personal-msg"
                class="w-full bg-pink-950/50 text-white p-4 rounded-xl border border-pink-500/50 focus:outline-none focus:border-pink-300 min-h-[120px]"
                placeholder="My dearest..."></textarea>
            <div class="flex gap-4 mt-6">
                <button onclick="document.getElementById('msg-modal').classList.add('hidden')"
                    class="px-6 py-2 rounded-full text-gray-300 hover:text-white">Cancel</button>
                <button id="submit-msg"
                    class="px-6 py-2 bg-pink-500 rounded-full text-white font-bold hover:bg-pink-400 hover:shadow-[0_0_15px_rgba(236,72,153,0.8)]">Seal
                    with a Kiss ğŸ’‹</button>
            </div>
        </div>
    </div>

    <div id="msg-overlay" class="fixed inset-0 z-50 flex items-center justify-center hidden pointer-events-none">
        <div id="animated-text"
            class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-pink-300 text-center drop-shadow-2xl px-6">
        </div>
    </div>

    <script type="module">
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => document.documentElement.classList.toggle('dark'));

        const bgmAudio = document.getElementById('bgm-audio');
        const bgmToggle = document.getElementById('bgm-toggle');
        bgmAudio.volume = 0.5;

        const removeIndicators = () => {
            const pulse = document.getElementById('audio-pulse');
            const hint = document.getElementById('audio-hint');
            if (pulse) pulse.remove();
            if (hint) hint.remove();
        };

        const unlockAudio = () => {
            bgmAudio.muted = false;
            bgmAudio.play().then(() => {
                bgmToggle.innerText = 'ğŸ”Š';
                bgmToggle.setAttribute('title', 'Mute Music');
                removeIndicators();
                ['click', 'touchstart', 'keydown'].forEach(ev => window.removeEventListener(ev, unlockAudio));
            }).catch(e => { });
        };
        ['click', 'touchstart', 'keydown'].forEach(ev => window.addEventListener(ev, unlockAudio));

        bgmAudio.play().then(() => {
            bgmAudio.muted = false;
            bgmToggle.innerText = 'ğŸ”Š';
            removeIndicators();
        }).catch(e => {
            bgmToggle.innerText = 'ğŸ”‡';
        });

        bgmToggle.addEventListener('click', () => {
            if (bgmAudio.muted || bgmAudio.paused) {
                bgmAudio.muted = false; bgmAudio.play(); bgmToggle.innerText = 'ğŸ”Š';
                bgmToggle.setAttribute('title', 'Mute Music');
                removeIndicators();
            } else {
                bgmAudio.muted = true; bgmToggle.innerText = 'ğŸ”‡';
                bgmToggle.setAttribute('title', 'Unmute Music');
            }
        });

        // Valentine Logic
        const noBtn = document.getElementById('btn-no');
        const yesBtn = document.getElementById('btn-yes');
        const valImg = document.getElementById('valentine-img');
        const valTitle = document.querySelector('#valentine-question-card h2');

        let dodgeCount = 0;
        const dodgeNo = () => {
            dodgeCount++;
            if (dodgeCount === 1) valImg.src = "/images/2.jpg";
            else if (dodgeCount === 2) valImg.src = "/images/5.webp";
            else if (dodgeCount >= 3) {
                gsap.to(noBtn, { x: window.innerWidth, y: -window.innerHeight, rotation: 1080, opacity: 0, scale: 0.2, duration: 1.5, ease: "power2.in", onComplete: () => noBtn.style.display = 'none' });
                return;
            }
            noBtn.style.position = 'absolute';
            const card = document.getElementById('valentine-question-card');
            let newLeft = 20 + Math.random() * (card.offsetWidth - noBtn.offsetWidth - 40);
            let newTop = 20 + Math.random() * (card.offsetHeight - noBtn.offsetHeight - 40);
            noBtn.style.left = newLeft + 'px';
            noBtn.style.top = newTop + 'px';
        };

        ['mouseover', 'click'].forEach(ev => noBtn.addEventListener(ev, dodgeNo));

        yesBtn.addEventListener('click', () => {
            // Priority 1: Instant Play
            bgmAudio.src = "/images/kilig.mp3";
            bgmAudio.load(); // Forces immediate switch
            bgmAudio.play().catch(e => { });

            valTitle.innerText = "YAY! I love you! ğŸ’•";
            valImg.src = "/images/6.gif";
            valImg.classList.remove('w-40');
            valImg.classList.add('w-72', 'max-w-full', 'md:w-96');
            noBtn.style.display = 'none';
            yesBtn.classList.add('hidden');
            // Explosion effect
            for (let i = 0; i < 150; i++) {
                const h = document.createElement('div');
                h.innerHTML = ['ğŸ’–', 'ğŸ’•', 'ğŸ’—', 'ğŸ’“', 'ğŸ’'][Math.floor(Math.random() * 5)];
                h.style.position = 'fixed';
                h.style.left = '50%';
                h.style.top = '50%';
                h.style.fontSize = Math.random() * 2 + 1 + 'rem';
                h.style.zIndex = '200';
                h.style.pointerEvents = 'none';
                document.body.appendChild(h);
                gsap.to(h, {
                    x: (Math.random() - 0.5) * window.innerWidth * 1.5,
                    y: (Math.random() - 0.5) * window.innerHeight * 1.5,
                    opacity: 0,
                    rotation: Math.random() * 720,
                    scale: Math.random() * 3 + 1,
                    duration: 3 + Math.random() * 2,
                    ease: "power4.out",
                    onComplete: () => h.remove()
                });
            }

            // Continuous Flood for 4 seconds
            const floodInterval = setInterval(() => {
                for (let i = 0; i < 8; i++) {
                    const h = document.createElement('div');
                    h.innerHTML = ['ğŸ’–', 'ğŸ’•', 'ğŸ’—', 'ğŸ’“', 'ğŸ’'][Math.floor(Math.random() * 5)];
                    h.style.position = 'fixed';
                    h.style.left = Math.random() * 100 + 'vw';
                    h.style.top = window.innerHeight + 50 + 'px';
                    h.style.fontSize = Math.random() * 2 + 1 + 'rem';
                    h.style.zIndex = '200';
                    h.style.pointerEvents = 'none';
                    document.body.appendChild(h);
                    gsap.to(h, {
                        y: -100,
                        x: "+=" + (Math.random() - 0.5) * 200,
                        rotation: Math.random() * 360,
                        duration: 3 + Math.random() * 2,
                        ease: "none",
                        onComplete: () => h.remove()
                    });
                }
            }, 100);
            setTimeout(() => clearInterval(floodInterval), 4000);
        });

        const heartContainer = document.getElementById('heart-container');
        setInterval(() => {
            const h = document.createElement('div');
            h.classList.add('heart');
            h.innerHTML = ['ğŸ’–', 'ğŸ’•', 'ğŸ’—', 'ğŸ’“', 'ğŸ’'][Math.floor(Math.random() * 5)];
            h.style.left = Math.random() * 100 + 'vw';
            h.style.animationDuration = Math.random() * 4 + 4 + 's';
            heartContainer.appendChild(h);
            setTimeout(() => h.remove(), 7000);
        }, 500);

        document.getElementById('send-heart').addEventListener('click', (e) => {
            const bh = document.createElement('div');
            bh.innerHTML = 'ğŸ’˜'; bh.style.position = 'fixed'; bh.style.left = e.clientX + 'px'; bh.style.top = e.clientY + 'px'; bh.style.fontSize = '3rem'; bh.style.pointerEvents = 'none'; bh.style.zIndex = '100';
            document.body.appendChild(bh);
            gsap.to(bh, { y: -500, x: (Math.random() - 0.5) * 200, scale: 3, opacity: 0, rotation: 45, duration: 2, ease: "power2.out", onComplete: () => bh.remove() });
        });

        document.getElementById('submit-msg').addEventListener('click', () => {
            const text = document.getElementById('personal-msg').value;
            if (text.trim() === '') return;
            document.getElementById('msg-modal').classList.add('hidden');
            const overlay = document.getElementById('msg-overlay');
            const textEl = document.getElementById('animated-text');
            overlay.classList.remove('hidden');
            textEl.innerText = text;
            gsap.fromTo(textEl, { scale: 0, opacity: 0, rotation: -10 }, { scale: 1, opacity: 1, rotation: 0, duration: 1.5, ease: "elastic.out(1, 0.5)" });
            setTimeout(() => { gsap.to(textEl, { opacity: 0, y: -100, duration: 1, onComplete: () => { overlay.classList.add('hidden'); document.getElementById('personal-msg').value = ''; } }); }, 4000);
        });
    </script>
</body>

</html>